<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FrostyPOS - Add Product</title>
  <link rel="stylesheet" href="styles.css"> <!-- uses your main POS style -->
  <style>
    /* Match POS layout */
    .form-container {
      background: #fff;
      padding: 2vh 2vw;
      border-radius: 1vw;
      box-shadow: 0 0.5vw 1vw rgba(0,0,0,0.06);
      margin-bottom: 3vh;
    }
    .form-group { margin-bottom: 2vh; }
    label { display: block; font-weight: bold; margin-bottom: 0.5vh; }
    input, select, button {
      width: 100%;
      padding: 1vh 1vw;
      border: 0.2vh solid #ccc;
      border-radius: 0.6vw;
      font-size: 1.2vw;
    }
    button {
      background: #4c5caf;
      color: #fff;
      cursor: pointer;
      border: none;
      transition: background 0.2s;
    }
    button:hover { background: #3e4e9a; }
    .cancel-btn {
      background: #ccc;
      color: #000;
    }
    .cancel-btn:hover { background: #aaa; }

    /* Product list cards */
    .product-item {
      background: #fff;
      padding: 1.5vh 2vw;
      border-radius: 1vw;
      margin-bottom: 2vh;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 0.5vw 1vw rgba(0,0,0,0.08);
    }
    .product-details {
      display: flex;
      align-items: center;
    }
    .product-details img {
      width: 8vh;
      height: 8vh;
      border-radius: 0.6vw;
      object-fit: cover;
      margin-right: 1vw;
    }
    .product-actions button {
      margin-left: 0.5vw;
      padding: 0.6vh 1.2vw;
      font-size: 1vw;
      border-radius: 0.6vw;
    }
    .product-actions .delete {
      background: #c62828;
    }
    .product-actions .delete:hover {
      background: #a21616;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="logo"><img src="frosty.jpg" alt="Frosty Logo"></div>
    <button class="nav-btn" onclick="location.href='FROSTY.html'">Menu</button>
    <button class="nav-btn" onclick="location.href='sales.html'">Sales</button>
    <button class="nav-btn active">Add Product</button>
    <button class="nav-btn logout" onclick="logout()">Logout</button>
  </aside>

  <!-- Main content -->
  <main>
    <h1 id="formTitle">Add New Product</h1>
    <div class="form-container">
      <div class="form-group">
        <label for="pname">Product Name</label>
        <input type="text" id="pname" required>
      </div>
      <div class="form-group">
        <label for="section">Section</label>
        <select id="section">
          <option value="Kiddie Edition">Kiddie Edition</option>
          <option value="Sundaes">Sundaes</option>
          <option value="Floats">Floats</option>
          <option value="Premium">Premium</option>
        </select>
      </div>
      <div class="form-group">
        <label for="sizes">Sizes (e.g. 12oz:39,16oz:49)</label>
        <input type="text" id="sizes" placeholder="12oz:39,16oz:49">
      </div>
      <div class="form-group">
        <label for="photo">Product Image</label>
        <input type="file" id="photo" accept="image/*">
      </div>
      <button onclick="saveProduct()" id="saveBtn">Save Product</button>
      <button onclick="resetForm()" type="button" class="cancel-btn">Cancel</button>
    </div>

    <h2>Existing Products</h2>
    <div id="productList"></div>
  </main>

  <script>
    let editingIndex = -1;

    function preloadMenu() {
      let products = JSON.parse(localStorage.getItem('products') || "[]");
      if (products.length === 0) {
        products = [
          {name:"Sugar Cone", section:"Kiddie Edition", sizes:"20", img:"frosty.jpg"},
          {name:"Mini Rainbow Delight", section:"Kiddie Edition", sizes:"45", img:"frosty.jpg"},
          {name:"Chocolate Sundae", section:"Sundaes", sizes:"37", img:"frosty.jpg"},
          {name:"Caramel Sundae", section:"Sundaes", sizes:"37", img:"frosty.jpg"},
          {name:"Coke Float", section:"Floats", sizes:"12oz:39,16oz:49", img:"frosty.jpg"},
          {name:"Supreme Oreo", section:"Premium", sizes:"12oz:68,16oz:78", img:"frosty.jpg"}
        ];
        localStorage.setItem('products', JSON.stringify(products));
      }
    }

    function saveProduct() {
      const name = document.getElementById('pname').value;
      const section = document.getElementById('section').value;
      const sizes = document.getElementById('sizes').value;
      const photoInput = document.getElementById('photo');
      let products = JSON.parse(localStorage.getItem('products') || "[]");

      if (!name || !section) {
        alert("Please fill all required fields");
        return;
      }

      if (photoInput.files.length > 0) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = e.target.result;
          saveOrUpdate(products, name, section, sizes, img);
        };
        reader.readAsDataURL(photoInput.files[0]);
      } else {
        const oldImg = (editingIndex >= 0) ? products[editingIndex].img : "frosty.jpg";
        saveOrUpdate(products, name, section, sizes, oldImg);
      }
    }

    function saveOrUpdate(products, name, section, sizes, img) {
      const product = { name, section, sizes, img };

      if (editingIndex >= 0) {
        products[editingIndex] = product;
        alert("Product updated!");
        editingIndex = -1;
        document.getElementById('formTitle').innerText = "Add New Product";
        document.getElementById('saveBtn').innerText = "Save Product";
      } else {
        products.push(product);
        alert("Product added!");
      }

      localStorage.setItem('products', JSON.stringify(products));
      resetForm();
      loadProducts();
    }

    function loadProducts() {
      const products = JSON.parse(localStorage.getItem('products') || "[]");
      const list = document.getElementById('productList');
      list.innerHTML = "";

      if (products.length === 0) {
        list.innerHTML = "<p>No products yet.</p>";
        return;
      }

      products.forEach((p, index) => {
        const div = document.createElement('div');
        div.className = "product-item";

        div.innerHTML = `
          <div class="product-details">
            <img src="${p.img}" alt="${p.name}">
            <div>
              <strong>${p.name}</strong> - <em>${p.section}</em><br>
              Sizes: ${p.sizes || "N/A"}
            </div>
          </div>
          <div class="product-actions">
            <button onclick="editProduct(${index})">Edit</button>
            <button class="delete" onclick="deleteProduct(${index})">Delete</button>
          </div>
        `;

        list.appendChild(div);
      });
    }

    function editProduct(index) {
      const products = JSON.parse(localStorage.getItem('products') || "[]");
      const p = products[index];
      document.getElementById('pname').value = p.name;
      document.getElementById('section').value = p.section;
      document.getElementById('sizes').value = p.sizes;
      editingIndex = index;
      document.getElementById('formTitle').innerText = "Edit Product";
      document.getElementById('saveBtn').innerText = "Update Product";
    }

    function deleteProduct(index) {
      if (!confirm("Are you sure you want to delete this product?")) return;
      let products = JSON.parse(localStorage.getItem('products') || "[]");
      products.splice(index, 1);
      localStorage.setItem('products', JSON.stringify(products));
      loadProducts();
    }

    function resetForm() {
      document.getElementById('pname').value = "";
      document.getElementById('section').value = "Kiddie Edition";
      document.getElementById('sizes').value = "";
      document.getElementById('photo').value = "";
      editingIndex = -1;
      document.getElementById('formTitle').innerText = "Add New Product";
      document.getElementById('saveBtn').innerText = "Save Product";
    }

    function logout() {
      localStorage.removeItem("loggedInUser");
      sessionStorage.clear();
      window.location.href = "login.html";
    }

    window.onload = function() {
      preloadMenu();
      loadProducts();
    }
  </script>
</body>
</html>
